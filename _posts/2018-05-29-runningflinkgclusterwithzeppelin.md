---
title: Rocking with Flink on a Zeppelin
image:  /images/flinkzeppelin/squirrelparty.jpg
category: environments
tags: [apache, flink, zeppelin, data, cluster, scala, setup, connection, interconnection, confiugration]
---

![Squirrel Partty Hard](/assets/images/flinkzeppelin/squirrelparty.jpg)

I recently started to use Apache Zeppelin, because I wanted a tool that allows me to work with notebooks using Scala + Apache Flink and as a plus, Apache Zeppelin provides you with autogenerated plots if you print you data as TSV file !!!!!!!

```
%table
t0 	 t1 	 t2 	 t3 	 t4 	 t5 	 t6 	 t7 	 t8 	 t9 	 t10 	 t11 	 t12 	 t13 	 t14
1	2	3	4	5	0	0	0	0	0	0	0	0	0	0
1	1	2	3	4	5	0	0	0	0	0	0	0	0	0
1	2	2	2	3	4	4	5	0	0	0	0	0	0	0
1	3	4	5	0	0	0	0	0	0	0	0	0	0	0
1	1	1	2	2	2	3	3	3	4	4	4	5	5	5
1	1	2	3	1	4	5	0	0	0	0	0	0	0	0
1	2	3	1	1	4	5	0	0	0	0	0	0	0	0
1	5	3	2	4	0	0	0	0	0	0	0	0	0	0
1	5	5	3	2	1	4	0	0	0	0	0	0	0	0
1	5	5	3	5	1	4	2	0	0	0	0	0	0	0
2	3	3	3	4	5	1	0	0	0	0	0	0	0	0
```

![table](/assets/images/flinkzeppelin/table.png)
![graph](/assets/images/flinkzeppelin/plot.png)


If you print your data inside a notebook paragraph it will automatically allow you to do scatter plots, bar plots, pie charts, etc. and c'mon that's freaking amazing, you don't have to write you data in a DB/File/Thing and then plot the data using other tools, so you can have all your work in a single place and that's nice.

So, if everything is nice, what am I doing here writting all this? By default, Zeppelin brings a Flink interpreter that you can use to run Flink workloads and when you execute it for the first time, it will start a Flink local minicluster in wich Zeppelin will run your workload and that's great if you are doing small tests, but when the problem scales a bit that cluster isn't enough. Also the Flink minicluster that brings Zeppelin is running Flink 1.1.3 and Flink 1.5 it's already out so I want to rock with Flink 1.5 instead of an older version if I am able to do it (Spoiler: we will be able to do it ;) )

## Creating our environmet

Let's get dirty and start to work a bit on all this, first of all we need to create the environment that we want to use, in this case it will be a Zeppelin Notebook Server, a Flink node running a Jobmanagar and two Flink nodes running Taskmanagers. With this in mind I've made the following docker-compose file:

```
version: "3"

services:
#=============================
#           FLINK
#=============================
  jobmanager:
    image: flink:1.5
    expose:
      - "6123"
    ports:
      - "6123:6123"
      - "8081:8081"
    command: jobmanager
    environment:
      - JOB_MANAGER_RPC_ADDRESS=jobmanager

  taskmanager:
    image: flink:1.5  
    expose:
      - "6121"
      - "6122"
    depends_on:
      - jobmanager
    command: taskmanager
    links:
      - "jobmanager:jobmanager"
    environment:
      - JOB_MANAGER_RPC_ADDRESS=jobmanager
#=============================
#         ZEPPELIN
#=============================
  zeppelin:
    image: apache/zeppelin:0.7.3
    ports:
      - "8080:8080"

```

Once we have this docker-compose file we can create our environment running the following docker-compose command

```
docker-compose up -d --scale taskmanager=2
```

So our environment should look like this:

```
            Name                           Command               State                       Ports                      
-----------------------------------------------------------------------------------------------------------------------
zeppelinflink15_jobmanager_1    /docker-entrypoint.sh jobm ...   Up      0.0.0.0:6123->6123/tcp, 0.0.0.0:8081->8081/tcp 
zeppelinflink15_taskmanager_1   /docker-entrypoint.sh task ...   Up      6121/tcp, 6122/tcp, 6123/tcp, 8081/tcp         
zeppelinflink15_taskmanager_2   /docker-entrypoint.sh task ...   Up      6121/tcp, 6122/tcp, 6123/tcp, 8081/tcp         
zeppelinflink15_zeppelin_1      /usr/bin/tini -- bin/zeppe ...   Up      0.0.0.0:8080->8080/tcp   
```

If we access to [http://localhost:8080](http://localhost:8080) we should have access to zeppeling UI 

![zeppelinUI](/assets/images/flinkzeppelin/zeppelinui.png)

And if we access to [http://localhost:8081](http://localhost:8081) we should be able to see Flink's Web UI

![FlinkUi](/assets/images/flinkzeppelin/flinkui.png)



